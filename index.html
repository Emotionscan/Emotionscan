<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Emotion Sense - Wellness & Emotion Scanner</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh; color: #333;
    }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    .app {
      background: white; border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden; min-height: 90vh;
    }
    .header {
      background: linear-gradient(135deg, #00b894 0%, #00a382 100%);
      color: white; padding: 30px; text-align: center;
    }
    .logo { font-size: 3rem; margin-bottom: 10px; }
    .title { font-size: 2.5rem; font-weight: 700; margin-bottom: 10px; }
    .subtitle { font-size: 1.2rem; opacity: 0.9; }

    .nav { display: flex; background: #f8f9fa; padding: 0 20px; flex-wrap: wrap; }
    .nav-item {
      padding: 20px; cursor: pointer; font-weight: 500;
      border-bottom: 3px solid transparent;
      transition: all 0.3s ease;
    }
    .nav-item.active { border-bottom-color: #00b894; color: #00b894; }
    .nav-item:hover { background: #e9ecef; }

    .content { padding: 30px; }
    .screen { display: none; }
    .screen.active { display: block; }

    .features {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px; margin: 40px 0;
    }
    .feature {
      background: white; padding: 25px; border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
      text-align: center; transition: transform 0.3s ease;
    }
    .feature:hover { transform: translateY(-5px); }
    .feature-icon { font-size: 2.5rem; color: #00b894; margin-bottom: 15px; }
    .feature-text { font-size: 1.1rem; color: #495057; }

    .buttons { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; }
    .btn {
      padding: 15px 30px; border: none; border-radius: 50px;
      font-size: 1.1rem; font-weight: 600; cursor: pointer;
      transition: all 0.3s ease; display: flex; align-items: center; gap: 10px;
    }
    .btn-primary { background: #00b894; color: white; }
    .btn-primary:hover { background: #00a382; transform: translateY(-2px); }
    .btn-secondary {
      background: white; color: #00b894; border: 2px solid #00b894;
    }
    .btn-secondary:hover { background: #f1f3f5; transform: translateY(-2px); }

    #video {
      width: 100%; max-width: 400px; border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }
    .camera-container { position: relative; margin: 30px 0; }
    .face-frame {
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      width: 200px; height: 200px;
      border: 3px solid #00ff88; border-radius: 50%;
    }
    .controls { display: flex; justify-content: center; gap: 20px; margin-top: 30px; }
    .btn-capture {
      background: #ff4757; color: white; padding: 20px;
      border-radius: 50%; width: 80px; height: 80px;
      display: flex; align-items: center; justify-content: center;
      border: 5px solid rgba(255,255,255,0.3);
      box-shadow: 0 5px 15px rgba(255,71,87,0.3);
    }
    .btn-flip { background: rgba(0,0,0,0.5); color: white; padding: 15px; border-radius: 50%; }
    .loading { display: none; margin: 20px 0; }
    .loading.active { display: block; }

    .results-header {
      text-align: center; padding: 30px; background: white;
      border-radius: 15px; margin-bottom: 30px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    }
    .emotion-icon { font-size: 4rem; margin-bottom: 20px; }
    .emotion-text { font-size: 2.5rem; font-weight: 700; margin-bottom: 10px; text-transform: uppercase; }
    .confidence-text { font-size: 1.2rem; color: #6c757d; }

    .details, .wellness {
      background: white; padding: 30px; border-radius: 15px;
      margin-bottom: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    }
    .section-title { font-size: 1.5rem; font-weight: 600; margin-bottom: 20px; color: #2d3436; }

    .emotion-row { display: flex; align-items: center; margin-bottom: 15px; }
    .emotion-label { width: 100px; text-transform: capitalize; color: #495057; }
    .bar-container { flex: 1; height: 10px; background: #e9ecef; border-radius: 5px; margin: 0 15px; overflow: hidden; }
    .bar { height: 100%; border-radius: 5px; transition: width 1s ease; }
    .percentage { width: 50px; text-align: right; color: #495057; }

    .happy { color: #feca57; }
    .sad { color: #54a0ff; }
    .angry { color: #ff6b6b; }
    .surprised { color: #ff9ff3; }
    .neutral { color: #c8d6e5; }
    .fear { color: #ff9f43; }
    .disgust { color: #a55eea; }

    .advice { font-size: 1.1rem; line-height: 1.6; color: #495057; }
    .quote {
      font-style: italic; color: #666; text-align: center; margin-top: 15px;
    }

    .history-item {
      display: flex; justify-content: space-between; align-items: center;
      padding: 15px; background: white; border-radius: 10px;
      margin-bottom: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .history-emotion {
      display: flex; align-items: center; gap: 15px;
    }
    .history-info { display: flex; flex-direction: column; align-items: flex-start; }
    .history-time { font-size: 0.8rem; color: #6c757d; }
    .clear-history {
      background: #ff6b6b; color: white; border: none; padding: 10px 20px;
      border-radius: 5px; cursor: pointer; margin-top: 20px;
    }
    .clear-history:hover { background: #ff5252; }

    .notification-btn {
      background: #ffb400; color: #111; border: none; padding: 12px 18px;
      border-radius: 8px; cursor: pointer; margin-top: 10px; font-weight: 600;
    }
    .notification-btn:hover { background: #ffc93c; }
    .quote-box {
      background: rgba(255,255,255,0.08); margin-top: 20px; padding: 15px;
      border-radius: 10px; color: #333; background: #f8f9fa;
    }

    @media (max-width:768px){
      .features{grid-template-columns:1fr;}
      .controls{flex-direction:column;}
      .nav{flex-direction:column; padding:0;}
      .nav-item{text-align:center;}
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="app">
      <div class="header">
        <div class="logo"><span class="material-icons">sentiment_satisfied_alt</span></div>
        <h1 class="title">Emotion Sense</h1>
        <p class="subtitle">Wellness & Emotion Scanner</p>
      </div>

      <div class="nav">
        <div class="nav-item active" data-target="home">Home</div>
        <div class="nav-item" data-target="scanner">Scanner</div>
        <div class="nav-item" data-target="results">Results</div>
        <div class="nav-item" data-target="history">History</div>
      </div>

      <div class="content">
        <!-- Home -->
        <div class="screen active" id="home">
          <div class="features">
            <div class="feature">
              <div class="feature-icon"><span class="material-icons">camera</span></div>
              <p class="feature-text">Scan your emotions in real time and receive wellness advice.</p>
            </div>
            <div class="feature">
              <div class="feature-icon"><span class="material-icons">favorite</span></div>
              <p class="feature-text">Personalized suggestions to improve mood and mental clarity.</p>
            </div>
            <div class="feature">
              <div class="feature-icon"><span class="material-icons">insights</span></div>
              <p class="feature-text">Track your emotional progress and build healthy habits.</p>
            </div>
          </div>
          <div class="buttons">
            <button class="btn btn-primary" onclick="showScreen('scanner')">
              <span class="material-icons">camera</span> Start Emotion Scan
            </button>
            <button class="btn btn-secondary" onclick="showScreen('history')">
              <span class="material-icons">history</span> View History
            </button>
          </div>
          
          <div class="quote-box">
            <h3>Today's Motivation 🌿</h3>
            <p id="dailyQuote">Click the button to receive daily motivational quotes!</p>
            <button class="notification-btn" id="enableNotifications">Enable Daily Motivation</button>
          </div>
        </div>

        <!-- Scanner -->
        <div class="screen" id="scanner">
          <div class="scanner-container" style="text-align:center;max-width:600px;margin:auto;">
            <h2>Face Emotion Scanner</h2>
            <p>Position your face within the circle and tap capture.</p>
            <div class="camera-container">
              <video id="video" autoplay playsinline></video>
              <div class="face-frame"></div>
            </div>
            <div class="loading" id="loading"><p>Analyzing emotions...</p></div>
            <div class="controls">
              <button class="btn-flip" onclick="flipCamera()">
                <span class="material-icons">flip_camera_ios</span>
              </button>
              <button class="btn-capture" onclick="captureEmotion()">
                <span class="material-icons">camera</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Results -->
        <div class="screen" id="results">
          <div class="results-header">
            <div class="emotion-icon" id="emotion-icon"><span class="material-icons">sentiment_neutral</span></div>
            <h2 class="emotion-text" id="emotion-text">Neutral</h2>
            <p class="confidence-text" id="confidence-text">75% confidence</p>
          </div>

          <div class="details">
            <h3 class="section-title">Detailed Analysis</h3>
            <div id="emotion-details"></div>
          </div>

          <div class="wellness">
            <h3 class="section-title">Wellness Guidance</h3>
            <p class="advice" id="wellness-advice">Your personalized advice will appear here.</p>
            <p class="quote" id="wellness-quote"></p>
          </div>

          <div class="buttons">
            <button class="btn btn-primary" onclick="showScreen('scanner')">
              <span class="material-icons">camera</span> Scan Again
            </button>
            <button class="btn btn-secondary" onclick="showScreen('history')">
              <span class="material-icons">history</span> View History
            </button>
          </div>
        </div>

        <!-- History -->
        <div class="screen" id="history">
          <h2>Emotion History</h2>
          <div class="history-list" id="history-list"></div>
          <button class="clear-history" onclick="clearHistory()">Clear History</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const state = {
      currentEmotion: null,
      emotionHistory: JSON.parse(localStorage.getItem('emotionHistory')) || [],
      videoStream: null,
      facingMode: 'user',
      emotions: ['happy', 'sad', 'angry', 'surprised', 'neutral', 'fear', 'disgust']
    };

    const video = document.getElementById('video');
    const loading = document.getElementById('loading');
    const emotionIcon = document.getElementById('emotion-icon');
    const emotionText = document.getElementById('emotion-text');
    const confidenceText = document.getElementById('confidence-text');
    const emotionDetails = document.getElementById('emotion-details');
    const historyList = document.getElementById('history-list');
    const wellnessAdvice = document.getElementById('wellness-advice');
    const wellnessQuote = document.getElementById('wellness-quote');
    const dailyQuote = document.getElementById('dailyQuote');
    const enableButton = document.getElementById('enableNotifications');

    const quotes = [
      "You are stronger than you think.",
      "Every day is a new beginning — make it count.",
      "Peace begins with a deep breath.",
      "Your emotions are valid. Take care of yourself.",
      "Small steps every day lead to big changes.",
      "Be proud of how far you've come.",
      "Happiness is not by chance, but by choice.",
      "Even the darkest night will end and the sun will rise.",
      "You deserve to feel peace today.",
      "Keep growing, glowing, and going."
    ];

    function showScreen(id) {
      document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
      document.querySelectorAll('.nav-item').forEach(i=>i.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      document.querySelector(`[data-target="${id}"]`).classList.add('active');
      if (id==='scanner') initCamera();
      else if (id==='history') renderHistory();
    }

    document.querySelectorAll('.nav-item').forEach(i=>i.addEventListener('click',()=>showScreen(i.dataset.target)));

    async function initCamera(){
      try {
        if (state.videoStream) state.videoStream.getTracks().forEach(t=>t.stop());
        const constraints={ video:{ facingMode: state.facingMode }, audio:false };
        state.videoStream=await navigator.mediaDevices.getUserMedia(constraints);
        video.srcObject=state.videoStream;
      } catch(e){ alert('Unable to access camera.'); }
    }

    function flipCamera(){
      state.facingMode = state.facingMode==='user'?'environment':'user';
      initCamera();
    }

    function detectEmotion(){
      const scores=state.emotions.map(()=>Math.random());
      const total=scores.reduce((a,b)=>a+b,0);
      const normalized=scores.map(s=>s/total);
      const results=state.emotions.map((e,i)=>({emotion:e,confidence:normalized[i]}))
        .sort((a,b)=>b.confidence-a.confidence);
      return { dominantEmotion:results[0].emotion, confidence:results[0].confidence, allEmotions:results, timestamp:new Date().toISOString() };
    }

    function captureEmotion(){
      loading.classList.add('active');
      setTimeout(()=>{
        const result=detectEmotion();
        state.currentEmotion=result;
        state.emotionHistory.unshift(result);
        localStorage.setItem('emotionHistory',JSON.stringify(state.emotionHistory.slice(0,50)));
        renderResults();
        loading.classList.remove('active');
        showScreen('results');
      },2000);
    }

    function renderResults(){
      if(!state.currentEmotion) return;
      const { dominantEmotion, confidence, allEmotions } = state.currentEmotion;
      emotionIcon.innerHTML=`<span class="material-icons ${dominantEmotion}">sentiment_${getSentimentIcon(dominantEmotion)}</span>`;
      emotionText.textContent=dominantEmotion;
      emotionText.className=`emotion-text ${dominantEmotion}`;
      confidenceText.textContent=`${Math.round(confidence*100)}% confidence`;
      emotionDetails.innerHTML='';
      allEmotions.forEach(item=>{
        const row=document.createElement('div');
        row.className='emotion-row';
        row.innerHTML=`
          <span class="emotion-label">${item.emotion}</span>
          <div class="bar-container"><div class="bar ${item.emotion}" style="width:${item.confidence*100}%"></div></div>
          <span class="percentage">${Math.round(item.confidence*100)}%</span>`;
        emotionDetails.appendChild(row);
      });
      renderWellnessAdvice(dominantEmotion);
    }

    function renderWellnessAdvice(emotion){
      const tips = {
        happy: {
          text: "Keep spreading your joy! Take a moment to appreciate what's making you smile. Gratitude keeps happiness alive.",
          quote: "“Happiness is not something ready-made. It comes from your own actions.” – Dalai Lama"
        },
        sad: {
          text: "It's okay to feel sad. Take a deep breath, talk to someone you trust, or listen to your favorite song. Small acts of self-care can lift your mood.",
          quote: "“Tough times never last, but tough people do.” – Robert Schuller"
        },
        angry: {
          text: "Try to pause and breathe deeply before reacting. A short walk or writing down your thoughts can help you cool down.",
          quote: "“For every minute you remain angry, you give up sixty seconds of peace of mind.” – Ralph Waldo Emerson"
        },
        surprised: {
          text: "Surprise can be exciting or shocking. Take a moment to reflect on what happened — sometimes surprises lead to growth!",
          quote: "“Life is full of surprises, and they often come when you least expect them.”"
        },
        neutral: {
          text: "You seem calm and balanced. Maintain this peace by practicing mindfulness or gentle stretching.",
          quote: "“Peace comes from within. Do not seek it without.” – Buddha"
        },
        fear: {
          text: "It's okay to feel fear — it's our body's way of protecting us. Try grounding techniques: focus on your breathing or name five things you can see.",
          quote: "“Do the thing you fear and the death of fear is certain.” – Ralph Waldo Emerson"
        },
        disgust: {
          text: "Something might be bothering you. Step back, reflect, and try to replace negative focus with something uplifting — like a walk or a good laugh.",
          quote: "“Don't let negative emotions define your outlook.”"
        }
      };
      const advice = tips[emotion] || { text: "Keep taking care of your mind and body.", quote: "" };
      wellnessAdvice.textContent = advice.text;
      wellnessQuote.textContent = advice.quote;
    }

    function renderHistory(){
      historyList.innerHTML='';
      if(state.emotionHistory.length===0){ historyList.innerHTML='<p>No emotion history yet.</p>'; return; }
      state.emotionHistory.forEach(item=>{
        const div=document.createElement('div');
        div.className='history-item';
        div.innerHTML=`
          <div class="history-emotion">
            <span class="material-icons ${item.dominantEmotion}">sentiment_${getSentimentIcon(item.dominantEmotion)}</span>
            <div class="history-info">
              <strong class="${item.dominantEmotion}">${item.dominantEmotion}</strong>
              <span class="history-time">${new Date(item.timestamp).toLocaleString()}</span>
            </div>
          </div>
          <span>${Math.round(item.confidence*100)}%</span>`;
        historyList.appendChild(div);
      });
    }

    function clearHistory(){
      state.emotionHistory=[];
      localStorage.removeItem('emotionHistory');
      renderHistory();
    }

    function getSentimentIcon(e){
      const icons={happy:'very_satisfied',sad:'dissatisfied',angry:'very_dissatisfied',surprised:'satisfied',neutral:'neutral',fear:'sentiment_anxious',disgust:'sick'};
      return icons[e]||'neutral';
    }

    // Random quote generator
    function showRandomQuote() {
      const random = quotes[Math.floor(Math.random() * quotes.length)];
      dailyQuote.textContent = random;
      return random;
    }

    // Notification logic
    async function requestNotificationPermission() {
      const permission = await Notification.requestPermission();
      if (permission === "granted") {
        alert("✅ Daily motivation notifications are enabled!");
        scheduleDailyNotification();
      } else {
        alert("Please allow notifications to receive daily motivation.");
      }
    }

    function scheduleDailyNotification() {
      showRandomQuote();
      const dailyQuote = showRandomQuote();

      // Immediate test notification
      new Notification("🌞 Your Daily Motivation", { body: dailyQuote });

      // Schedule next notification every 24 hours
      setInterval(() => {
        const quote = showRandomQuote();
        new Notification("🌿 Stay Inspired", { body: quote });
      }, 24 * 60 * 60 * 1000);
    }

    document.addEventListener('DOMContentLoaded',()=>{
      renderHistory();
      showRandomQuote();
    });

    enableButton.addEventListener('click', requestNotificationPermission);
  </script>
</body>
</html>
